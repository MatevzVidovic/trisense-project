version: "3.9"



services:
  app:
    build:
      context: .
      dockerfile: .docker/Dockerfile.cpu
      args:
        ENV_NAME: myenv        # keep in sync with conda-gpu.yml 'name:'
    image: myproject:conda-myenv
    working_dir: /workspace
    tty: true
    stdin_open: true

    environment:
      DISPLAY: ${DISPLAY}
      WAYLAND_DISPLAY: ${WAYLAND_DISPLAY}
      XDG_RUNTIME_DIR: ${XDG_RUNTIME_DIR}
      QT_X11_NO_MITSHM: "1" # disable shared memory of X client and X server. Use port communication.

    # Live-edit your code without rebuilding the image
    volumes:
      - .:/workspace:rw
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Optionally mount big data/checkpoints separately:
      # - ./data:/data:ro
      # - ./checkpoints:/checkpoints:rw

    # Start a shell (env auto-activates via /etc/bash.bashrc)
    command: bash


# services:
#   app:
#     build:
#       context: .
#       dockerfile: docker/Dockerfile.gpu
#       args:
#         ENV_NAME: myenv        # keep in sync with conda-gpu.yml 'name:'
#     image: myproject:cuda10-conda-myenv
#     working_dir: /workspace
#     tty: true
#     stdin_open: true

#     # Live-edit your code without rebuilding the image
#     volumes:
#       - .:/workspace:rw
#       # Optionally mount big data/checkpoints separately:
#       # - ./data:/data:ro
#       # - ./checkpoints:/checkpoints:rw

#     # Enable GPU if your host has NVIDIA toolkit set up
#     # (Docker Desktop + WSL2 or native Linux)
#     gpus: all

#     # Start a shell (env auto-activates via /etc/bash.bashrc)
#     command: bash
